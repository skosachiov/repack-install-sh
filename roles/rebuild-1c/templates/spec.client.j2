# rpmrebuild autogenerated specfile

%define defaultbuildroot /
AutoProv: no
%undefine __find_provides
AutoReq: no
%undefine __find_requires
# Do not try autogenerate prereq/conflicts/obsoletes and check files
%undefine __check_files
%undefine __find_prereq
%undefine __find_conflicts
%undefine __find_obsoletes
# Be sure buildpolicy set to do nothing
%define __spec_install_post %{nil}
# Something that need for rpm-4.1
%define _missing_doc_files_terminate_build 0
#dummy
#dummy
#BUILDHOST:    0e72d7f61113
#BUILDTIME:    Sat Aug 27 23:35:22 2022
#SOURCERPM:    1c-enterprise-{{version_dot}}.src.rpm

#RPMVERSION:   4.4.2.3



#OS:           linux
#SIZE:           342266045
#ARCHIVESIZE:           342305880
#ARCH:         x86_64
BuildArch:     x86_64
Name:          1c-enterprise-{{version_dot}}-client
Version:       {{version_dot_major}}
Release:       {{version_release}}
License:       commercial 
Group:         Applications/Databases
Summary:       1C:Enterprise 8.3 client components for Linux
Distribution:  1C:Enterprise 8.3

URL:           www.1c.ru
Vendor:        1C






Prefix:        /opt/1cv8/x86_64/{{version_dot}}
Provides:      accntui.so()(64bit)  
Provides:      basicui.so()(64bit)  
Provides:      bpui.so()(64bit)  
Provides:      calcui.so()(64bit)  
Provides:      chartui.so()(64bit)  
Provides:      config.so()(64bit)  
Provides:      configshell.so()(64bit)  
Provides:      coreui83.so()(64bit)  
Provides:      dbgmc.so()(64bit)  
Provides:      dcsui.so()(64bit)  
Provides:      debug.so()(64bit)  
Provides:      devtool.so()(64bit)  
Provides:      dhistui.so()(64bit)  
Provides:      dsgncmd.so()(64bit)  
Provides:      dsgnfrm.so()(64bit)  
Provides:      ecsui.so()(64bit)  
Provides:      edbui.so()(64bit)  
Provides:      extui.so()(64bit)  
Provides:      fmtdui.so()(64bit)  
Provides:      frame.so()(64bit)  
Provides:      frntend.so()(64bit)  
Provides:      helpui.so()(64bit)  
Provides:      htmlui.so()(64bit)  
Provides:      imageui.so()(64bit)  
Provides:      integui.so()(64bit)  
Provides:      libssh.so()(64bit)  
Provides:      libssh_wrapper.so()(64bit)  
Provides:      libwx_gtk3u-3.0.so.0()(64bit)  
Provides:      libwx_gtk3u-3.0.so.0(WXU_3.0)(64bit)  
Provides:      libwx_gtk3u-3.0.so.0(WXU_3.0.1)(64bit)  
Provides:      libxdiff.so()(64bit)  
Provides:      mapui.so()(64bit)  
Provides:      mmui.so()(64bit)  
Provides:      mngcln.so()(64bit)  
Provides:      mngdsgn.so()(64bit)  
Provides:      mngui.so()(64bit)  
Provides:      moxelui.so()(64bit)  
Provides:      notifywin.so()(64bit)  
Provides:      perform.so()(64bit)  
Provides:      pictedt.so()(64bit)  
Provides:      plnnrui.so()(64bit)  
Provides:      richui.so()(64bit)  
Provides:      schemui.so()(64bit)  
Provides:      testmc.so()(64bit)  
Provides:      txtedui.so()(64bit)  
Provides:      uiproxywx.so()(64bit)  
Provides:      wbase.so()(64bit)  
Provides:      1c-enterprise-{{version_dot}}-client = {{version_dot}}
Requires:      /bin/sh  
Requires(post): /bin/sh  
Requires(postun): /bin/sh  
Requires:      1c-enterprise-{{version_dot}}-common = {{version_dot}}
Requires:      1c-enterprise-{{version_dot}}-server = {{version_dot}}
Requires:      core83.so()(64bit)  
Requires:      coreui83.so()(64bit)  
Requires:      ld-linux-x86-64.so.2()(64bit)  
Requires:      ld-linux-x86-64.so.2(GLIBC_2.3)(64bit)  
Requires:      libSM.so.6()(64bit)  
Requires:      libX11.so.6()(64bit)  
Requires:      libatk-1.0.so.0()(64bit)  
Requires:      libc.so.6()(64bit)  
Requires:      libc.so.6(GLIBC_2.2.5)(64bit)  
Requires:      libc.so.6(GLIBC_2.3)(64bit)  
Requires:      libc.so.6(GLIBC_2.3.2)(64bit)  
Requires:      libc.so.6(GLIBC_2.3.4)(64bit)  
Requires:      libc.so.6(GLIBC_2.4)(64bit)  
Requires:      libc.so.6(GLIBC_2.7)(64bit)  
Requires:      libc.so.6(GLIBC_2.8)(64bit)  
Requires:      libc.so.6(GLIBC_2.9)(64bit)  
Requires:      libcairo-gobject.so.2()(64bit)  
Requires:      libcairo.so.2()(64bit)  
Requires:      libcups.so.2()(64bit)  
Requires:      libdl.so.2()(64bit)  
Requires:      libdl.so.2(GLIBC_2.2.5)(64bit)  
Requires:      libfontconfig.so.1()(64bit)  
Requires:      libfreetype.so.6()(64bit)  
Requires:      libgcc_s.so.1()(64bit)  
Requires:      libgcc_s.so.1(GCC_3.0)(64bit)  
Requires:      libgcc_s.so.1(GCC_3.4)(64bit)  
Requires:      libgdk-3.so.0()(64bit)  
Requires:      libgdk_pixbuf-2.0.so.0()(64bit)  
Requires:      libgio-2.0.so.0()(64bit)  
Requires:      libglib-2.0.so.0()(64bit)  
Requires:      libgobject-2.0.so.0()(64bit)  
Requires:      libgthread-2.0.so.0()(64bit)  
Requires:      libgtk-3.so.0()(64bit)  
Requires:      libm.so.6()(64bit)  
Requires:      libm.so.6(GLIBC_2.2.5)(64bit)  
Requires:      libpango-1.0.so.0()(64bit)  
Requires:      libpangocairo-1.0.so.0()(64bit)  
Requires:      libpangoft2-1.0.so.0()(64bit)  
Requires:      libpthread.so.0()(64bit)  
Requires:      libpthread.so.0(GLIBC_2.2.5)(64bit)  
Requires:      libpthread.so.0(GLIBC_2.3.2)(64bit)  
Requires:      libpthread.so.0(GLIBC_2.3.3)(64bit)  
Requires:      librt.so.1()(64bit)  
Requires:      librt.so.1(GLIBC_2.2.5)(64bit)  
Requires:      libsoup-2.4.so.1()(64bit)  
Requires:      libssh.so()(64bit)  
Requires:      libstdc++.so.6()(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.1)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.3)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.8)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.9)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.11)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.14)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.15)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.18)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.20)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.21)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.22)(64bit)  
Requires:      libtcmalloc_minimal.so.4()(64bit)  
Requires:      libwebkitgtk-3.0.so.0()(64bit)  
Requires:      libwx_gtk3u-3.0.so.0()(64bit)  
Requires:      libwx_gtk3u-3.0.so.0(WXU_3.0)(64bit)  
Requires:      libxdiff.so()(64bit)  
Requires:      libz.so.1()(64bit)  
Requires:      nuke83.so()(64bit)  
#Requires:      rpmlib(CompressedFileNames) <= 3.0.4-1
#Requires:      rpmlib(PayloadFilesHavePrefix) <= 4.0-1
Requires:      rtld(GNU_HASH)  
Requires:      uiproxywx.so()(64bit)  
Requires:      wbase.so()(64bit)  





%description
1C:Enterprise 8.3 client components for Linux.
This set of components contains 1C:Enterprise client applications for Linux


%prep

%build

%install
mkdir -p %{buildroot}/
cp -r ../../1c-enterprise-{{version_dot}}-client/* %buildroot/

%clean

%files
/*



%post -p /bin/sh
# 1cestart location with libs (only if arch is same)
[ `getconf LONG_BIT` = "64" ] && OS_ARCH="x86_64" || OS_ARCH="i386"
if [ x86_64 = $OS_ARCH ]; then
    mkdir -p /opt/1cv8/common && chmod 755 /opt/1cv8/common
    function version_greater()  { test "$(printf '%%s\n' "$@" | sort -V | head -n 1)" != "$1"; }
    # Copy "1cestart" with deps to "common"
    NEW_VERSION={{version_dot}}
    if [ ! -f /opt/1cv8/common/1cestart ]; then
        # "1cestart" is not exists
        copyStarter="yes";
    else
        # "1cestart" exists
        INSTALLED_VERSION=`find /opt/1cv8/x86_64 -type d -name "*.*.*.*" | sort -rV | head -n 1 | awk -F/ '{print $NF}'`
        if version_greater $NEW_VERSION $INSTALLED_VERSION; then
            copyStarter="yes";
        fi
    fi
    if [ "$copyStarter" = "yes" ]; then
        cp -a /opt/1cv8/x86_64/{{version_dot}}/{1cestart,nuke83.so,uiproxywx.so,core*.so,libwx_gtk3u-3.0.*,libicu*,libstdc++.so.6,libtcmalloc_minimal.so.4*} /opt/1cv8/common
        rm -rf /usr/share/applications/1cestart-*.desktop
        cp /opt/1cv8/x86_64/{{version_dot}}/1cestart-{{version_dot}}.desktop /usr/share/applications
    fi
fi
# Create "1c-install"
SecConsoleApps=/etc/security/console.apps
if [ -d "$SecConsoleApps" ] && [ `which consolehelper 2>/dev/null` ]; then
    P1CInstallScript=1c-install
    ConsoleHelperPath=`which consolehelper`
    P1CInstallScriptPath=`dirname $ConsoleHelperPath`/$P1CInstallScript
    echo -e "USER=root\nPROGRAM=`which rpm`" > $SecConsoleApps/$P1CInstallScript
    ln -rs "$ConsoleHelperPath" "$P1CInstallScriptPath" &>/dev/null || :
    cat <<EOF > /etc/pam.d/$P1CInstallScript
#%%PAM-1.0
auth		include		config-util
account		include		config-util
session		include		config-util
EOF
fi
touch --no-create /usr/share/icons/hicolor &>/dev/null || :

%posttrans -p /bin/sh
gtk-update-icon-cache /usr/share/icons/hicolor &>/dev/null || :
# =============================================================================


%postun -p /bin/sh
# Removing 1cestart with libs (only if archs is same)
[ `getconf LONG_BIT` = "64" ] && OS_ARCH="x86_64" || OS_ARCH="i386"
if [ x86_64 = $OS_ARCH ]; then
    if [ `find /opt/1cv8/x86_64/*.*.*.* -type f ! -name "*.*" -a -name 1cv8c 2>/dev/null | wc -l` -eq 0 ]; then
        rm -f /opt/1cv8/common/{1cestart,*.so*} /usr/share/applications/1cestart-*.desktop
        find /opt/1cv8/common -type d -empty -delete &>/dev/null || :
    fi
fi
if [ $1 -eq 0 ] ; then
    touch --no-create /usr/share/icons/hicolor &>/dev/null
    gtk-update-icon-cache /usr/share/icons/hicolor &>/dev/null || :
fi

%changelog

