# rpmrebuild autogenerated specfile

%define defaultbuildroot /
AutoProv: no
%undefine __find_provides
AutoReq: no
%undefine __find_requires
# Do not try autogenerate prereq/conflicts/obsoletes and check files
%undefine __check_files
%undefine __find_prereq
%undefine __find_conflicts
%undefine __find_obsoletes
# Be sure buildpolicy set to do nothing
%define __spec_install_post %{nil}
# Something that need for rpm-4.1
%define _missing_doc_files_terminate_build 0
#dummy
#dummy
#BUILDHOST:    0e72d7f61113
#BUILDTIME:    Sat Aug 27 23:35:22 2022
#SOURCERPM:    1c-enterprise-{{version_dot}}.src.rpm

#RPMVERSION:   4.4.2.3



#OS:           linux
#SIZE:           346291560
#ARCHIVESIZE:           346344908
#ARCH:         x86_64
BuildArch:     x86_64
Name:          1c-enterprise-{{version_dot}}-thin-client
Version:       {{version_dot_major}}
Release:       {{version_release}}
License:       commercial 
Group:         Applications/Databases
Summary:       1C:Enterprise 8.3 thin client components for Linux
Distribution:  1C:Enterprise 8.3

URL:           www.1c.ru
Vendor:        1C






Prefix:        /opt/1cv8/x86_64/{{version_dot}}
Conflicts:     1c-enterprise-{{version_dot}}-common  
Provides:      addin.so()(64bit)  
Provides:      addncpp.so()(64bit)  
Provides:      backbas.so()(64bit)  
Provides:      bsl.so()(64bit)  
Provides:      chart.so()(64bit)  
Provides:      chartui.so()(64bit)  
Provides:      core83.so()(64bit)  
Provides:      coreui83.so()(64bit)  
Provides:      dbeng8.so()(64bit)  
Provides:      dbgbase.so()(64bit)  
Provides:      dbgmc.so()(64bit)  
Provides:      dbgtgt.so()(64bit)  
Provides:      dcscore.so()(64bit)  
Provides:      dhistui.so()(64bit)  
Provides:      ecscmn.so()(64bit)  
Provides:      ecscore.so()(64bit)  
Provides:      ecsui.so()(64bit)  
Provides:      enums.so()(64bit)  
Provides:      ext.so()(64bit)  
Provides:      extui.so()(64bit)  
Provides:      fmtd.so()(64bit)  
Provides:      fmtdcmn.so()(64bit)  
Provides:      fmtdui.so()(64bit)  
Provides:      frame.so()(64bit)  
Provides:      frmcore.so()(64bit)  
Provides:      grphcs.so()(64bit)  
Provides:      help.so()(64bit)  
Provides:      helpui.so()(64bit)  
Provides:      html.so()(64bit)  
Provides:      htmlui.so()(64bit)  
Provides:      image.so()(64bit)  
Provides:      imageui.so()(64bit)  
Provides:      inet.so()(64bit)  
Provides:      json.so()(64bit)  
Provides:      libMagick++-7.Q8.so.4()(64bit)  
Provides:      libMagickCore-7.Q8.so.7()(64bit)  
Provides:      libMagickWand-7.Q8.so.7()(64bit)  
Provides:      libMagickWand-7.Q8.so.7(VERS_7.0)(64bit)  
Provides:      libcairo-v8.so()(64bit)  
Provides:      libgsf-v8.so()(64bit)  
Provides:      libicudata.so.46()(64bit)  
Provides:      libicui18n.so.46()(64bit)  
Provides:      libicuuc.so.46()(64bit)  
Provides:      liblcms2.so.2()(64bit)  
Provides:      libnghttp2.so.14()(64bit)  
Provides:      libstdc++.so.6()(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.1)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.10)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.11)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.2)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.3)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.4)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.5)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.6)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.7)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.8)(64bit)  
Provides:      libstdc++.so.6(CXXABI_1.3.9)(64bit)  
Provides:      libstdc++.so.6(CXXABI_FLOAT128)(64bit)  
Provides:      libstdc++.so.6(CXXABI_TM_1)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.1)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.10)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.11)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.12)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.13)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.14)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.15)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.16)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.17)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.18)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.19)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.2)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.20)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.21)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.22)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.23)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.24)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.3)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.4)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.5)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.6)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.7)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.8)(64bit)  
Provides:      libstdc++.so.6(GLIBCXX_3.4.9)(64bit)  
Provides:      libtcmalloc_minimal.so.4()(64bit)  
Provides:      libunwind.so.8()(64bit)  
Provides:      libwx_gtk3u-3.0.so.0()(64bit)  
Provides:      libwx_gtk3u-3.0.so.0(WXU_3.0)(64bit)  
Provides:      libwx_gtk3u-3.0.so.0(WXU_3.0.1)(64bit)  
Provides:      map.so()(64bit)  
Provides:      mapui.so()(64bit)  
Provides:      mmui.so()(64bit)  
Provides:      mngcln.so()(64bit)  
Provides:      mngcore.so()(64bit)  
Provides:      mngui.so()(64bit)  
Provides:      moxel.so()(64bit)  
Provides:      moxelui.so()(64bit)  
Provides:      notifywin.so()(64bit)  
Provides:      nuke83.so()(64bit)  
Provides:      pack.so()(64bit)  
Provides:      plnnr.so()(64bit)  
Provides:      plnnrcmn.so()(64bit)  
Provides:      plnnrui.so()(64bit)  
Provides:      rclient.so()(64bit)  
Provides:      rscalls.so()(64bit)  
Provides:      rserver.so()(64bit)  
Provides:      rtrsrvc.so()(64bit)  
Provides:      scheme.so()(64bit)  
Provides:      schemui.so()(64bit)  
Provides:      sqlite.so()(64bit)  
Provides:      techsys.so()(64bit)  
Provides:      testmc.so()(64bit)  
Provides:      txtedt.so()(64bit)  
Provides:      txtedui.so()(64bit)  
Provides:      uiproxywx.so()(64bit)  
Provides:      vrscore.so()(64bit)  
Provides:      wbase.so()(64bit)  
Provides:      ws.so()(64bit)  
Provides:      xdto.so()(64bit)  
Provides:      xml2.so()(64bit)  
Provides:      1c-enterprise-{{version_dot}}-thin-client = {{version_dot}}
Requires:      /bin/sh  
Requires(post): /bin/sh  
Requires(postun): /bin/sh  
Requires:      core83.so()(64bit)  
Requires:      coreui83.so()(64bit)  
Requires:      ld-linux-x86-64.so.2()(64bit)  
Requires:      ld-linux-x86-64.so.2(GLIBC_2.3)(64bit)  
Requires:      libMagick++-7.Q8.so.4()(64bit)  
Requires:      libMagickCore-7.Q8.so.7()(64bit)  
Requires:      libMagickWand-7.Q8.so.7()(64bit)  
Requires:      libMagickWand-7.Q8.so.7(VERS_7.0)(64bit)  
Requires:      libSM.so.6()(64bit)  
Requires:      libX11.so.6()(64bit)  
Requires:      libatk-1.0.so.0()(64bit)  
Requires:      libc.so.6()(64bit)  
Requires:      libc.so.6(GLIBC_2.11)(64bit)  
Requires:      libc.so.6(GLIBC_2.2.5)(64bit)  
Requires:      libc.so.6(GLIBC_2.3)(64bit)  
Requires:      libc.so.6(GLIBC_2.3.2)(64bit)  
Requires:      libc.so.6(GLIBC_2.3.3)(64bit)  
Requires:      libc.so.6(GLIBC_2.3.4)(64bit)  
Requires:      libc.so.6(GLIBC_2.4)(64bit)  
Requires:      libc.so.6(GLIBC_2.7)(64bit)  
Requires:      libc.so.6(GLIBC_2.8)(64bit)  
Requires:      libc.so.6(GLIBC_2.9)(64bit)  
Requires:      libcairo-gobject.so.2()(64bit)  
Requires:      libcairo.so.2()(64bit)  
Requires:      libcups.so.2()(64bit)  
Requires:      libdl.so.2()(64bit)  
Requires:      libdl.so.2(GLIBC_2.2.5)(64bit)  
Requires:      libfontconfig.so.1()(64bit)  
Requires:      libfreetype.so.6()(64bit)  
Requires:      libgcc_s.so.1()(64bit)  
Requires:      libgcc_s.so.1(GCC_3.0)(64bit)  
Requires:      libgcc_s.so.1(GCC_3.3)(64bit)  
Requires:      libgcc_s.so.1(GCC_3.4)(64bit)  
Requires:      libgcc_s.so.1(GCC_4.2.0)(64bit)  
Requires:      libgdk-3.so.0()(64bit)  
Requires:      libgdk_pixbuf-2.0.so.0()(64bit)  
Requires:      libgio-2.0.so.0()(64bit)  
Requires:      libglib-2.0.so.0()(64bit)  
Requires:      libgobject-2.0.so.0()(64bit)  
Requires:      libgthread-2.0.so.0()(64bit)  
Requires:      libgtk-3.so.0()(64bit)  
Requires:      libicudata.so.46()(64bit)  
Requires:      libicui18n.so.46()(64bit)  
Requires:      libicuuc.so.46()(64bit)  
Requires:      liblcms2.so.2()(64bit)  
Requires:      libm.so.6()(64bit)  
Requires:      libm.so.6(GLIBC_2.2.5)(64bit)  
Requires:      libnghttp2.so.14()(64bit)  
Requires:      libpango-1.0.so.0()(64bit)  
Requires:      libpangocairo-1.0.so.0()(64bit)  
Requires:      libpangoft2-1.0.so.0()(64bit)  
Requires:      libpthread.so.0()(64bit)  
Requires:      libpthread.so.0(GLIBC_2.2.5)(64bit)  
Requires:      libpthread.so.0(GLIBC_2.3.2)(64bit)  
Requires:      libpthread.so.0(GLIBC_2.3.3)(64bit)  
Requires:      librt.so.1()(64bit)  
Requires:      librt.so.1(GLIBC_2.2.5)(64bit)  
Requires:      libsoup-2.4.so.1()(64bit)  
Requires:      libstdc++.so.6()(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.1)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.11)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.2)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.3)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.8)(64bit)  
Requires:      libstdc++.so.6(CXXABI_1.3.9)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.11)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.14)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.15)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.17)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.18)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.19)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.20)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.21)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.22)(64bit)  
Requires:      libstdc++.so.6(GLIBCXX_3.4.9)(64bit)  
Requires:      libtcmalloc_minimal.so.4()(64bit)  
Requires:      libunwind.so.8()(64bit)  
Requires:      libwebkitgtk-3.0.so.0()(64bit)  
Requires:      libwx_gtk3u-3.0.so.0()(64bit)  
Requires:      libwx_gtk3u-3.0.so.0(WXU_3.0)(64bit)  
Requires:      libz.so.1()(64bit)  
Requires:      nuke83.so()(64bit)  
#Requires:      rpmlib(CompressedFileNames) <= 3.0.4-1
#Requires:      rpmlib(PayloadFilesHavePrefix) <= 4.0-1
Requires:      rtld(GNU_HASH)  
Requires:      sqlite.so()(64bit)  
Requires:      uiproxywx.so()(64bit)  
Requires:      wbase.so()(64bit)  





%description
1C:Enterprise 8.3 thin client for Linux
This set of components contains 1C:Enterprise thin client for Linux



%prep

%build

%install
mkdir -p %{buildroot}/
cp -r ../../1c-enterprise-{{version_dot}}-thin-client/* %buildroot/

%clean

%files
/*



%post -p /bin/sh
mkdir -p /opt/1cv8/conf && chmod 755 /opt/1cv8/conf
if [ ! -f /opt/1cv8/conf/conf.cfg ]; then
    [ -z "$USER" ] && conf_locale="System" || conf_locale=`su - $USER -c locale | grep "LANG=" | cut -d"=" -f2 | cut -d"_" -f1 | awk '{ print toupper($0); }'`
    [ -z "$conf_locale" ] && conf_locale="System"
    [ -f /opt/1cv8/conf/conf.cfg ] || echo "SystemLanguage=$conf_locale" > /opt/1cv8/conf/conf.cfg
fi
# 1cestart location with libs (only if same archs)
[ `getconf LONG_BIT` = "64" ] && OS_ARCH="x86_64" || OS_ARCH="i386"
if [ x86_64 = $OS_ARCH ]; then
    mkdir -p /opt/1cv8/common && chmod 755 /opt/1cv8/common
    function version_greater()  { test "$(printf '%%s\n' "$@" | sort -V | head -n 1)" != "$1"; }
    # Copy "1cestart" with deps to "common"
    NEW_VERSION={{version_dot}}
    if [ ! -f /opt/1cv8/common/1cestart ]; then
        # "1cestart" is not exists
        copyStarter="yes";
    else
        # "1cestart" exists
        INSTALLED_VERSION=`find /opt/1cv8/x86_64 -type d -name "*.*.*.*" | sort -rV | head -n 1 | awk -F/ '{print $NF}'`
        if version_greater $NEW_VERSION $INSTALLED_VERSION; then
            copyStarter="yes";
        fi
    fi
    if [ "$copyStarter" = "yes" ]; then
        cp -a /opt/1cv8/x86_64/{{version_dot}}/{1cestart,nuke83.so,uiproxywx.so,core*.so,libwx_gtk3u-3.0.*,libicu*,libstdc++.so.6,libtcmalloc_minimal.so.4*} /opt/1cv8/common
        rm -rf /usr/share/applications/1cestart-*.desktop
        cp /opt/1cv8/x86_64/{{version_dot}}/1cestart-{{version_dot}}.desktop /usr/share/applications
    fi
fi
# Create "1c-install"
SecConsoleApps=/etc/security/console.apps
if [ -d "$SecConsoleApps" ] && [ `which consolehelper 2>/dev/null` ]; then
    P1CInstallScript=1c-install
    ConsoleHelperPath=`which consolehelper`
    P1CInstallScriptPath=`dirname $ConsoleHelperPath`/$P1CInstallScript
    echo -e "USER=root\nPROGRAM=`which rpm`" > $SecConsoleApps/$P1CInstallScript
    ln -rs "$ConsoleHelperPath" "$P1CInstallScriptPath" &>/dev/null || :
    cat <<EOF > /etc/pam.d/$P1CInstallScript
#%%PAM-1.0
auth		include		config-util
account		include		config-util
session		include		config-util
EOF
fi
touch --no-create /usr/share/icons/hicolor &>/dev/null || :

%posttrans -p /bin/sh
gtk-update-icon-cache /usr/share/icons/hicolor &>/dev/null || :
# =============================================================================


%postun -p /bin/sh
if [ `find /opt/1cv8 -type f ! -name "*.*" -a \( -name 1cv8c -o -name "r*" -o -name "ib*" \) 2>/dev/null | wc -l` -eq 0 ]; then
    rm -f /opt/1cv8/conf/conf.cfg
    find /opt/1cv8/conf -type d -empty -delete &>/dev/null || :
fi
# Removing 1cestart with libs (only if archs is same)
[ `getconf LONG_BIT` = "64" ] && OS_ARCH="x86_64" || OS_ARCH="i386"
if [ `find /opt/1cv8/x86_64/*.*.*.* -type f ! -name "*.*" -a -name 1cv8c 2>/dev/null | wc -l` -eq 0 ]; then
    rm -f /opt/1cv8/common/{1cestart,*.so*} /usr/share/applications/1cestart-*.desktop
    find /opt/1cv8/common -type d -empty -delete &>/dev/null || :
fi
find /opt/1cv8 -type d -empty -delete &>/dev/null || :
if [ $1 -eq 0 ] ; then
    touch --no-create /usr/share/icons/hicolor &>/dev/null
    gtk-update-icon-cache /usr/share/icons/hicolor &>/dev/null || :
fi

%changelog

